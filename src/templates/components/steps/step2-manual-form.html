<div class="fr-mb-4w">
  <h3>Informations √† renseigner</h3>
  <p class="fr-text--sm">Compl√©tez les informations suivantes pour affiner l'analyse</p>

  <div class="fr-callout fr-callout--green-emeraude fr-mt-4w">
    <p class="fr-callout__text">
      Ces donn√©es permettront d'affiner le calcul de l'indice de mutabilit√© et d'am√©liorer la fiabilit√© des r√©sultats.
    </p>
  </div>
  <form id="manual-form">
    <!-- Terrain & B√¢ti -->
    <fieldset class="fr-fieldset fr-mb-4w">
      <legend class="fr-fieldset__legend fr-text--lead">
        üèóÔ∏è Terrain & B√¢ti
      </legend>

      <div class="fr-fieldset__content">
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="terrain-viabilise">
                Terrain viabilis√©
                <span class="fr-hint-text">Le terrain dispose-t-il des r√©seaux de base ?</span>
              </label>
              <select class="fr-select" id="terrain-viabilise" name="terrainViabilise" required>
                <option value="">S√©lectionner une option</option>
                <option value="oui">Oui</option>
                <option value="non">Non</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="etat-bati">
                √âtat du b√¢ti et infrastructure
                <span class="fr-hint-text">√âtat g√©n√©ral des constructions existantes</span>
              </label>
              <select class="fr-select" id="etat-bati" name="etatBati" required>
                <option value="">S√©lectionner une option</option>
                <option value="pas-de-bati">Pas de b√¢ti</option>
                <option value="en-ruine-dangereux">En ruine / dangereux</option>
                <option value="forte-degradation">Forte d√©gradation</option>
                <option value="etat-moyen">√âtat moyen</option>
                <option value="bon-etat-apparent">Bon √©tat apparent</option>
                <option value="etat-remarquable">√âtat remarquable</option>
                <option value="batiments-heterogenes">B√¢timents h√©t√©rog√®nes</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="presence-pollution">
                Pr√©sence de pollution
                <span class="fr-hint-text">Pollution des sols connue ou suspect√©e</span>
              </label>
              <select class="fr-select" id="presence-pollution" name="presencePollution" required>
                <option value="">S√©lectionner une option</option>
                <option value="non">Non</option>
                <option value="deja-geree">D√©j√† g√©r√©e</option>
                <option value="oui-composes-volatils">Oui - compos√©s volatils</option>
                <option value="oui-autres-composes">Oui - autres compos√©s</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <!-- Qualit√© -->
    <fieldset class="fr-fieldset fr-mb-4w">
      <legend class="fr-fieldset__legend fr-text--lead">
        ‚≠ê Qualit√©
      </legend>

      <div class="fr-fieldset__content">
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="valeur-architecturale">
                Valeur architecturale et/ou histoire sociale
                <span class="fr-hint-text">Int√©r√™t architectural et historique du b√¢ti</span>
              </label>
              <select class="fr-select" id="valeur-architecturale" name="valeurArchitecturale" required>
                <option value="">S√©lectionner une option</option>
                <option value="sans-interet">Sans int√©r√™t</option>
                <option value="banal-infra-ordinaire">Banal / infra-ordinaire</option>
                <option value="ordinaire">Ordinaire</option>
                <option value="interet-fort">Int√©r√™t fort</option>
                <option value="exceptionnel">Exceptionnel</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="qualite-paysagere">
                Paysage
                <span class="fr-hint-text">Insertion dans le paysage environnant</span>
              </label>
              <select class="fr-select" id="qualite-paysagere" name="qualitePaysagere" required>
                <option value="">S√©lectionner une option</option>
                <option value="degrade">D√©grad√©</option>
                <option value="banal-infra-ordinaire">Banal / infra-ordinaire</option>
                <option value="quotidien-ordinaire">Quotidien / ordinaire</option>
                <option value="interessant">Int√©ressant</option>
                <option value="remarquable">Remarquable</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="qualite-desserte">
                Qualit√© de la voie de desserte
                <span class="fr-hint-text">Accessibilit√© par les voies de circulation</span>
              </label>
              <select class="fr-select" id="qualite-desserte" name="qualiteDesserte" required>
                <option value="">S√©lectionner une option</option>
                <option value="accessible">Accessible</option>
                <option value="degradee">D√©grad√©e</option>
                <option value="peu-accessible">Peu accessible</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

  </form>


</div>

<div class="fr-mt-4w" style="text-align: center;">
  <button class="fr-btn fr-btn--secondary" onclick="goToStep(1)">
    <span class="fr-icon-arrow-left-s-line fr-icon--sm" aria-hidden="true"></span>
    Pr√©c√©dent
  </button>
  <button class="fr-btn fr-ml-2w" onclick="submitAndGoToResult()" id="submit-btn">
    Calculer les r√©sultats
    <span class="fr-icon-arrow-right-s-line fr-icon--sm" aria-hidden="true"></span>
  </button>
</div>

<script>
  function goToStep(step) {
    window.location.href = `/form/${step}`;
  }

  function submitAndGoToResult() {
    const form = document.getElementById('manual-form');
    const formData = new FormData(form);

    // Validation basique
    const requiredFields = ['terrainViabilise', 'etatBati', 'presencePollution', 'valeurArchitecturale', 'qualitePaysagere', 'qualiteDesserte'];
    let isValid = true;

    requiredFields.forEach(field => {
      const element = document.getElementById(field.replace(/([A-Z])/g, '-$1').toLowerCase());
      if (!element.value) {
        element.classList.add('fr-input--error');
        isValid = false;
      } else {
        element.classList.remove('fr-input--error');
      }
    });

    if (!isValid) {
      alert('Veuillez remplir tous les champs obligatoires');
      return;
    }

    // Simulation de sauvegarde
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Calcul en cours...';

    // Simulation d'un d√©lai de traitement
    setTimeout(() => {
      // Ici envoyer les donn√©es √† l'API
      // fetch('/api/evaluate', { method: 'POST', body: formData })
      goToStep(3);
    }, 2000);
  }

  // Validation en temps r√©el
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('manual-form');
    const inputs = form.querySelectorAll('select');

    inputs.forEach(input => {
      input.addEventListener('change', function () {
        if (this.value) {
          this.classList.remove('fr-input--error');
        }
      });
    });
  });
</script>