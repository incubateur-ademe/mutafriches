<div class="fr-mb-4w">
  <h3>Informations √† renseigner</h3>
  <p class="fr-text--sm">Compl√©tez les informations suivantes pour affiner l'analyse</p>

  <form id="manual-form">
    <!-- Terrain & B√¢ti -->
    <fieldset class="fr-fieldset fr-mb-4w">
      <legend class="fr-fieldset__legend fr-text--lead">
        üèóÔ∏è Terrain & B√¢ti
      </legend>

      <div class="fr-fieldset__content">
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="terrain-viabilise">
                Terrain viabilis√©
                <span class="fr-hint-text">Le terrain dispose-t-il des r√©seaux de base ?</span>
              </label>
              <select class="fr-select" id="terrain-viabilise" name="terrainViabilise" required>
                <option value="">S√©lectionner une option</option>
                <option value="oui" selected>Oui</option>
                <option value="non">Non</option>
                <option value="ne-sait-pas">Ne sait pas</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="etat-bati">
                √âtat du b√¢ti
                <span class="fr-hint-text">√âtat g√©n√©ral des constructions existantes</span>
              </label>
              <select class="fr-select" id="etat-bati" name="etatBati" required>
                <option value="">S√©lectionner une option</option>
                <option value="bon">Bon √©tat</option>
                <option value="moyen">√âtat moyen</option>
                <option value="mauvais">Mauvais √©tat</option>
                <option value="heterogene" selected>B√¢timents h√©t√©rog√®nes</option>
                <option value="ruine">En ruine</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="presence-pollution">
                Pr√©sence de pollution
                <span class="fr-hint-text">Pollution des sols connue ou suspect√©e</span>
              </label>
              <select class="fr-select" id="presence-pollution" name="presencePollution" required>
                <option value="">S√©lectionner une option</option>
                <option value="oui">Oui, confirm√©e</option>
                <option value="suspectee">Suspect√©e</option>
                <option value="non">Non</option>
                <option value="ne-sait-pas" selected>Ne sait pas</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <!-- Qualit√© -->
    <fieldset class="fr-fieldset fr-mb-4w">
      <legend class="fr-fieldset__legend fr-text--lead">
        ‚≠ê Qualit√©
      </legend>

      <div class="fr-fieldset__content">
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="qualite-patrimoniale">
                Qualit√© patrimoniale
                <span class="fr-hint-text">Valeur architecturale et historique</span>
              </label>
              <select class="fr-select" id="qualite-patrimoniale" name="qualitePatrimoniale" required>
                <option value="">S√©lectionner une option</option>
                <option value="exceptionnel" selected>Exceptionnel</option>
                <option value="remarquable">Remarquable</option>
                <option value="interessant">Int√©ressant</option>
                <option value="banal">Banal</option>
                <option value="sans-interet">Sans int√©r√™t</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="qualite-paysagere">
                Qualit√© paysag√®re
                <span class="fr-hint-text">Insertion dans le paysage environnant</span>
              </label>
              <select class="fr-select" id="qualite-paysagere" name="qualitePaysagere" required>
                <option value="">S√©lectionner une option</option>
                <option value="remarquable">Remarquable</option>
                <option value="interessant">Int√©ressant</option>
                <option value="banal" selected>Banal / infra-ordinaire</option>
                <option value="degrade">D√©grad√©</option>
              </select>
            </div>
          </div>

          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-select-group">
              <label class="fr-label" for="qualite-desserte">
                Qualit√© de la desserte
                <span class="fr-hint-text">Accessibilit√© par les voies de circulation</span>
              </label>
              <select class="fr-select" id="qualite-desserte" name="qualiteDesserte" required>
                <option value="">S√©lectionner une option</option>
                <option value="excellente">Excellente</option>
                <option value="bonne">Bonne</option>
                <option value="accessible" selected>Accessible</option>
                <option value="difficile">Difficile</option>
                <option value="tres-difficile">Tr√®s difficile</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <!-- Informations compl√©mentaires -->
    <fieldset class="fr-fieldset fr-mb-4w">
      <legend class="fr-fieldset__legend fr-text--lead">
        üìù Informations compl√©mentaires
      </legend>

      <div class="fr-fieldset__content">
        <div class="fr-input-group">
          <label class="fr-label" for="commentaires">
            Commentaires ou observations
            <span class="fr-hint-text">Ajoutez toute information utile pour l'analyse (optionnel)</span>
          </label>
          <textarea class="fr-input" id="commentaires" name="commentaires" rows="4"
            placeholder="Exemple : Pr√©sence d'amiante suspect√©e, acc√®s difficile en hiver, contraintes particuli√®res..."></textarea>
        </div>
      </div>
    </fieldset>
  </form>

  <div class="fr-callout fr-callout--blue-france fr-mt-4w">
    <h4 class="fr-callout__title">üí° Information</h4>
    <p class="fr-callout__text">
      Ces donn√©es permettront d'affiner le calcul de l'indice de mutabilit√© et d'am√©liorer la fiabilit√© des r√©sultats.
    </p>
  </div>
</div>

<div class="fr-btns-group fr-btns-group--right fr-mt-4w">
  <button class="fr-btn fr-btn--secondary" onclick="goToStep(2)">
    <span class="fr-icon-arrow-left-s-line fr-icon--sm" aria-hidden="true"></span>
    Pr√©c√©dent
  </button>
  <button class="fr-btn" onclick="submitAndGoToStep4()" id="submit-btn">
    Calculer les r√©sultats
    <span class="fr-icon-arrow-right-s-line fr-icon--sm" aria-hidden="true"></span>
  </button>
</div>

<script>
  function goToStep(step) {
    window.location.href = `/form/${step}`;
  }

  function submitAndGoToStep4() {
    const form = document.getElementById('manual-form');
    const formData = new FormData(form);

    // Validation basique
    const requiredFields = ['terrainViabilise', 'etatBati', 'presencePollution', 'qualitePatrimoniale', 'qualitePaysagere', 'qualiteDesserte'];
    let isValid = true;

    requiredFields.forEach(field => {
      const element = document.getElementById(field.replace(/([A-Z])/g, '-$1').toLowerCase());
      if (!element.value) {
        element.classList.add('fr-input--error');
        isValid = false;
      } else {
        element.classList.remove('fr-input--error');
      }
    });

    if (!isValid) {
      alert('Veuillez remplir tous les champs obligatoires');
      return;
    }

    // Simulation de sauvegarde
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Calcul en cours... <span class="fr-icon-loader-line fr-icon--sm" aria-hidden="true"></span>';

    // Simulation d'un d√©lai de traitement
    setTimeout(() => {
      // Ici vous pourriez envoyer les donn√©es √† votre API
      // fetch('/api/analyze', { method: 'POST', body: formData })

      goToStep(4);
    }, 2000);
  }

  // Validation en temps r√©el
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('manual-form');
    const inputs = form.querySelectorAll('select');

    inputs.forEach(input => {
      input.addEventListener('change', function () {
        if (this.value) {
          this.classList.remove('fr-input--error');
        }
      });
    });
  });
</script>